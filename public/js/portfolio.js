// Sample projects data (expanded for demonstration)
const projects = [

    {
        id: 73,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/54.jpeg"
    },
    {
        id: 74,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/55.jpeg"
    },
    {
        id: 75,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/56.jpeg"
    },
    {
        id: 76,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/57.jpeg"
    },
    {
        id: 77,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/58.jpeg"
    },
    {
        id: 78,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/59.jpeg"
    },
    {
        id: 79,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/60.jpeg"
    },
    {
        id: 80,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/61.jpeg"
    },
    {
        id: 81,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/62.jpeg"
    },
    {
        id: 82,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/63.jpeg"
    },
    {
        id: 83,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/64.jpeg"
    },
    {
        id: 84,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/65.jpeg"
    },
    {
        id: 85,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/66.jpeg"
    },
    {
        id: 86,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/67.jpeg"
    },
    {
        id: 87,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/68.jpeg"
    },
    {
        id: 89,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/70.jpeg"
    },
    {
        id: 90,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/71.jpeg"
    },
    {
        id: 91,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/72.jpeg"
    },
    {
        id: 92,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/73.jpeg"
    },
    {
        id: 93,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/74.jpeg"
    },
    {
        id: 94,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/75.jpeg"
    },
    {
        id: 95,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/76.jpeg"
    },
    {
        id: 96,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/77.jpeg"
    },
    {
        id: 97,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/78.jpeg"
    },
    {
        id: 97,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/79.jpeg"
    },
    {
        id: 98,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/80.jpeg"
    },
    {
        id: 99,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/81.jpeg"
    },
    {
        id: 1,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/11.jpeg"
    },
    {
        id: 2,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/12.jpeg"
    },
    {
        id: 3,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/13.jpeg"
    },
    {
        id: 4,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/14.jpeg"
    },
    {
        id: 5,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/15.jpeg"
    },
    {
        id: 6,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/16.jpeg"
    },
    {
        id: 7,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/1.jpeg"
    },
    {
        id: 8,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/2.jpeg"
    },
    {
        id: 9,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/3.jpeg"
    },
    {
        id: 10,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/4.jpeg"
    },
    {
        id: 11,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/5.jpeg"
    },
    {
        id: 12,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/6.jpeg"
    },
    {
        id: 13,
        title: "Road Construction and Earthworks",
        category: "road",
        image: "./assets/portfolio/road construction and earthworks/10.jpeg"
    },
    {
        id: 14,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/1.jpeg"
    },
    {
        id: 15,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/2.jpeg"
    },
    {
        id: 16,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/3.jpeg"
    },
    {
        id: 17,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/4.jpeg"
    },
    {
        id: 18,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/5.jpeg"
    },
    {
        id: 19,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/6.jpeg"
    },
    {
        id: 20,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/7.jpeg"
    },
    {
        id: 21,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/8.jpeg"
    },
    {
        id: 22,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/9.jpeg"
    },
    {
        id: 23,
        title: "Geotechnical and ground testing",
        category: "geotechnical",
        image: "./assets/portfolio/Geotechnical and ground testing/10.jpeg"
    },
    {
        id: 24,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/1.jpeg"
    },
    {
        id: 25,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/2.jpeg"
    },
    {
        id: 26,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/3.jpeg"
    },
    {
        id: 27,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/5.jpeg"
    },
    {
        id: 28,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/4.jpeg"
    },
    {
        id: 29,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/6.jpeg"
    },
    {
        id: 30,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/10.jpeg"
    },
    {
        id: 31,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/11.jpeg"
    },
    {
        id: 32,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/12.jpeg"
    },
    {
        id: 33,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/13.jpeg"
    },
    {
        id: 34,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/15.jpeg"
    },
    {
        id: 35,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/18.jpeg"
    },
    {
        id: 36,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/19.jpeg"
    },
    {
        id: 37,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/20.jpeg"
    },
    {
        id: 38,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/22.jpeg"
    },
    {
        id: 39,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/23.jpeg"
    },
    {
        id: 40,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/26.jpeg"
    },
    {
        id: 41,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/27.jpeg"
    },
    {
        id: 42,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/31.jpeg"
    },
    {
        id: 43,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/32.jpeg"
    },
    {
        id: 44,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/33.jpeg"
    },
    {
        id: 45,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/34.jpeg"
    },
    {
        id: 46,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/43.jpeg"
    },
    {
        id: 47,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/44.jpeg"
    },
    {
        id: 48,
        title: "Structural Engineering",
        category: "structural",
        image: "./assets/portfolio/structural engineering and building/45.jpeg"
    },
    {
        id: 49,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/1.jpeg"
    },
    {
        id: 50,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/2.jpeg"
    },
    {
        id: 51,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/3.jpeg"
    },
    {
        id: 52,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/4.jpeg"
    },
    {
        id: 53,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/5.jpeg"
    },
    {
        id: 54,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/6.jpeg"
    },
    {
        id: 55,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/7.jpeg"
    },
    {
        id: 56,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/8.jpeg"
    },
    {
        id: 57,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/9.jpeg"
    },
    {
        id: 58,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/10.jpeg"
    },
    {
        id: 59,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/11.jpeg"
    },
    {
        id: 60,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/12.jpeg"
    },
    {
        id: 61,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/13.jpeg"
    },
    {
        id: 62,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/14.jpeg"
    },
    {
        id: 63,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/15.jpeg"
    },
    {
        id: 64,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/16.jpeg"
    },
    {
        id: 65,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/17.jpeg"
    },
    {
        id: 66,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/18.jpeg"
    },
    {
        id: 67,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/19.jpeg"
    },
    {
        id: 68,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/20.jpeg"
    },
    {
        id: 69,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/21.jpeg"
    },
    {
        id: 70,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/22.jpeg"
    },
    {
        id: 71,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/23.jpeg"
    },
    {
        id: 72,
        title: "Water and irrigation Engineering",
        category: "water",
        image: "./assets/portfolio/water and irrigation engineering/24.jpeg"
    },

];

// Filter categories - first 4 are shown directly, rest in modal
const allFilters = [
    { key: 'all', label: 'All Projects' },
    { key: 'road', label: 'Road Construction' },
    { key: 'geotechnical', label: 'Geotechnical' },
    { key: 'structural', label: 'Structural Engineering' },
    { key: 'water', label: 'Water and irrigation Engineering' },
];

let displayedProjects = 6;
let currentFilter = 'all';

function createGalleryItem(project) {
    return `
                <div class="gallery-item" data-category="${project.category}">
                    <img src="${project.image}" alt="${project.title}" loading="lazy">
                    <div class="gallery-overlay">
                        <h3>${project.title}</h3>
                    </div>
                </div>
            `;
}

function renderGallery() {
    const gallery = document.getElementById('gallery');
    const filteredProjects = currentFilter === 'all'
        ? projects.slice(0, displayedProjects)
        : projects.filter(p => p.category === currentFilter).slice(0, displayedProjects);

    gallery.innerHTML = filteredProjects.map(createGalleryItem).join('');

    // Update load more button visibility
    const loadMoreBtn = document.getElementById('loadMore');
    const totalFiltered = currentFilter === 'all' ? projects.length : projects.filter(p => p.category === currentFilter).length;
    loadMoreBtn.style.display = displayedProjects >= totalFiltered ? 'none' : 'block';
}

function filterProjects(category) {
    currentFilter = category;
    displayedProjects = 6;

    // Update active filter button (only for main tabs)
    document.querySelectorAll('.gallery-filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    const activeBtn = document.querySelector(`[data-filter="${category}"]`);
    if (activeBtn) {
        activeBtn.classList.add('active');
    }

    // Add animation delay for smooth transition
    const items = document.querySelectorAll('.gallery-item');
    items.forEach(item => item.classList.add('hidden'));

    setTimeout(() => {
        renderGallery();
    }, 300);
}

function loadMore() {
    displayedProjects += 3;
    renderGallery();
}

function populateModal() {
    const modalFilters = document.getElementById('modalFilters');
    // Skip the first 4 filters as they're already in the main tabs
    const additionalFilters = allFilters.slice(4);

    modalFilters.innerHTML = additionalFilters.map(filter => `
                <button class="modal-filter-btn" data-filter="${filter.key}">
                    ${filter.label}
                </button>
            `).join('');

    // Add event listeners to modal filter buttons
    modalFilters.querySelectorAll('.modal-filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            filterProjects(btn.dataset.filter);
            closeModal();
        });
    });
}

function openModal() {
    document.getElementById('filterModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    document.getElementById('filterModal').classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Event listeners
document.querySelectorAll('.gallery-filter-btn').forEach(btn => {
    if (btn.id !== 'viewMoreBtn') {
        btn.addEventListener('click', () => {
            filterProjects(btn.dataset.filter);
        });
    }
});

document.getElementById('viewMoreBtn').addEventListener('click', openModal);
document.getElementById('closeModal').addEventListener('click', closeModal);
document.getElementById('filterModal').addEventListener('click', (e) => {
    if (e.target.id === 'filterModal') {
        closeModal();
    }
});

document.getElementById('loadMore').addEventListener('click', loadMore);

// Handle ESC key to close modal
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeModal();
    }
});

// Initialize
populateModal();
renderGallery();

// Add smooth scroll animation on load
window.addEventListener('load', () => {
    const items = document.querySelectorAll('.gallery-item');
    items.forEach((item, index) => {
        setTimeout(() => {
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, index * 100);
    });
});